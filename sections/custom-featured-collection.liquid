{%- style -%}
  .section-{{ section.id }}-margin {
  margin-top: {{ section.settings.margin_top_desktop }}px;
  margin-bottom: {{ section.settings.margin_bottom_desktop }}px;
  }
  .section-{{ section.id }}-padding {
  padding-top: {{ section.settings.padding_top_desktop }}px;
  padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
  }

  @media screen and (max-width: 768px) {
  .section-{{ section.id }}-margin {
  margin-top: {{ section.settings.margin_top_mobile }}px;
  margin-bottom: {{ section.settings.margin_bottom_mobile }}px;
  }
  .section-{{ section.id }}-padding {
  padding-top: {{ section.settings.padding_top_mobile }}px;
  padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
  }
  }
{%- endstyle -%}
{% assign coll = section.settings.collection %}
{% assign show = section.settings.products_to_show | default: 4 %}
<section class="py-12 md:py-16 {{ section.settings.bg_class | default: 'bg-[#294e6b]' }} text-white section-{{ section.id }}-margin section-{{ section.id }}-padding">
  <div class="mx-auto section section--page-width  ">
    <!-- Header -->
    <div class="flex flex-col md:flex-row  md:justify-between gap-4! md:gap-8! mb-10 lg:mb-16! lg:items-center items-start px-4 lg:px-0">
      {% if section.settings.heading != blank %}
        <h2 class="text-[#F7F5F2]! lg:text-[38px]! text-[26px]! not-italic font-medium lg:leading-[1.1] leading-[1.2] lg:max-w-[400px]">
          {{ section.settings.heading }}
        </h2>
      {% endif %}
      {% if section.settings.copy != blank %}
        <p class="text-white  lg:text-[17px]! text-[12px]! not-italic font-normal lg:leading-none leading-[1.1] lg:max-w-[324px] ">
          {{ section.settings.copy }}
        </p>
      {% endif %}
      {% if section.settings.cta_label and section.settings.cta_link %}
        <div class="md:text-right md:pt-2 lg:w-auto w-full">
          <a
            href="{{ section.settings.cta_link }}"
            class="inline-flex items-center gap-2 lg:text-[16px]! text-[14px]! font-medium uppercase whitespace-nowrap !text-[#fff] "
          >
            <span class="border-b border-white">{{ section.settings.cta_label }}</span>
             <span aria-hidden="true" class="text-[17px]">â†’</span>
          </a>
        </div>
      {% endif %}
    </div>
    {% if coll and coll.products_count > 0 %}
      <!-- Mobile Swiper -->
      <div class="lg:hidden">
        <div class="swiper swiper-{{ section.id }}">
          <div class="swiper-wrapper relative">
            {% for product in coll.products limit: show %}
              {% assign v = product.selected_or_first_available_variant %}
              <div class="swiper-slide relative">
                <article class="rounded-[16px] bg-[#ADD1F2] py-[12px] px-[22px]">
                  {% if product.tags contains 'bestseller' %}
                    <span
                      class="inline-block bg-[#EDE1DD] text-[#1E1E1E] text-[11px]! font-semibold px-[10px] py-[5px] rounded-full leading-normal mb-[21px]"
                    >
                      Bestseller
                    </span>
                  {% endif %}
                  <div class="rounded-xl  h-full flex flex-col gap-[8px]!">
                    <a href="{{ product.url }}" class="block group text-center">
                      <p
                        class="inline-block border border-[#2A5072] text-[#2A5072] text-[13px] font-medium px-3.5 py-1 mx-1 my-4 rounded-full leading-none"
                      >
                        Retinol + Vitamin E
                      </p>
                      
                      <h3 class="text-[#2A5072]! text-[20px]!  not-italic font-semibold! leading-normal ">
                        {{ product.title | escape | truncatewords: 3 }}
                      </h3>
                      <div class=" ">
                        {% if v.compare_at_price > v.price %}
                          <span class="text-[#2A5072] text-center  text-[14px] not-italic font-normal leading-normal"
                            >Yours at {{ v.price | money -}}
                          </span>
                        {% endif %}
                      </div> 
                       <div class="flex items-center justify-center overflow-hidden">
                    {% if product.metafields.custom.product_card_image_at_home != blank %}
                      {{
                        product.metafields.custom.product_card_image_at_home
                        | image_url: width: 740
                        | image_tag: loading: 'lazy', class: 'block h-full w-[185px]! lg:w-full object-contain '
                      }}
                    {% else %}
                      {{
                        product.featured_image
                        | image_url: width: 740
                        | image_tag: loading: 'lazy', class: 'block h-full w-[185px]! lg:w-full object-contain'
                      }}
                    {% endif %}
                  </div>
                    </a>
                    <div class="mt-auto">
                      <div class="mt-auto">
                        {% assign v = product.selected_or_first_available_variant %}
                        {% if v and v.available %}
                          {% assign can_add_to_cart = true %}
                          {% assign add_to_cart_text = 'products.product.add_to_cart' | t %}
                        {% else %}
                          {% assign can_add_to_cart = false %}
                          {% assign add_to_cart_text = 'products.product.sold_out' | t %}
                        {% endif %}

                        {%- assign product_form_id = 'BuyButtons-ProductForm-'
                          | append: section.id
                          | append: '-'
                          | append: product.id
                        -%}

                        <product-form-component
                          data-section-id="{{ section.id }}"
                          data-product-id="{{ product.id }}"
                          data-product-url="{{ product.url }}"
                          on:submit="/handleSubmit"
                          data-quantity-default="{% if v.quantity_rule.min %}{{ v.quantity_rule.min }}{% else %}1{% endif %}"
                        >
                          {%- form 'product', product, id: product_form_id, data-type: 'add-to-cart-form' -%}
                            <input type="hidden" name="id" ref="variantId" value="{{ v.id }}">
                            <div class="atc-wrap mt-[12px] relative">
                              {%
                                render 'add-to-cart-button',
                                can_add_to_cart: can_add_to_cart,
                                add_to_cart_text: add_to_cart_text,
                                product: product,
                                icon_only_on_mobile: true,
                                id: 'atc-' | append: product.id
                              %}
                            </div>
                          {%- endform -%}
                        </product-form-component>
                      </div>
                      <p class="text-[#2A5072]! text-[10.5px]! not-italic font-normal leading-normal text-center mt-4">
                        {{ product.metafields.custom.product_features }}
                      </p>
                    </div>
                  </div>
                </article>
              </div>
            {% endfor %}
          </div>
          <div class="mt-4 flex items-center justify-between">
            <div class="swiper-pagination hidden"></div>
          </div>
        </div>
      </div>
      <!-- Desktop Grid -->
      <div class="hidden! lg:block! lg:h-[610px]!">
        <ul class="lg:grid grid-cols-4 gap-6 ">
          {% for product in coll.products limit: show %}
            {% assign v = product.selected_or_first_available_variant %}
            <li
              class="
                card-outer rounded-2xl bg-[#ADD1F2] py-3 px-[22px] relative group
           transform transition-all duration-500 ease-in-out
           hover:scale-y-110 hover:shadow-lg max-h-[550px]
            "
            >
              <div class="h-full flex flex-col gap-[20! relative">
                {% if product.tags contains 'bestseller' %}
                  <span
                    class="inline-block bg-[#EDE1DD] text-[#1E1E1E] text-[11px] font-semibold px-2.5 py-[5px] rounded-full leading-normal max-w-[75px] m-b-[20px]"
                  >
                    Bestseller
                  </span>
                {% endif %}
                <a href="{{ product.url }}" class="block group text-center">
                  <p
                    class="inline-block border border-[#2A5072] text-[#2A5072] text-[13px] font-medium px-3.5 py-1 mx-1 mb-[18px] rounded-full leading-none"
                  >
                    Retinol + Vitamin E
                  </p>
                   <div class="text group-hover:opacity-100 transition-opacity duration-500 mb-2">
                  {% if v.compare_at_price > v.price %}
                    <span class="text-[#0d2235] text-center text-[14px] font-normal leading-normal  group-hover:text-[#5480a7] transition-opacity duration-500">
                      Yours at {{ v.price | money }}
                    </span>
                  {% endif %}
                </div>
                  <h3 class="text-[#2A5072]! text-[20px]! not-italic  max-w-[450px]   font-bold! leading-normal mb-[16px]">
                    {{ product.title | escape | truncatewords: 4 }}
                  </h3>

                  <div class="flex items-center justify-center overflow-hidden  w-full">
                    {% if product.metafields.custom.product_card_image_at_home != blank %}
                      {{
                        product.metafields.custom.product_card_image_at_home
                        | image_url: width: 740
                        | image_tag: loading: 'lazy', class: 'block h-full object-contain w-[200px]! '
                      }}
                    {% else %}
                      {{
                        product.featured_image
                        | image_url: width: 740
                        | image_tag: loading: 'lazy', class: 'block h-full  object-contain w-[200px]!'
                      }}
                    {% endif %}
                  </div>
                </a>
               
                  {% assign v = product.selected_or_first_available_variant %}
                  {% if v and v.available %}
                    {% assign can_add_to_cart = true %}
                    {% assign add_to_cart_text = 'products.product.add_to_cart' | t %}
                  {% else %}
                    {% assign can_add_to_cart = false %}
                    {% assign add_to_cart_text = 'products.product.sold_out' | t %}
                  {% endif %}
                  {%- assign product_form_id = 'BuyButtons-ProductForm-'
                    | append: section.id
                    | append: '-'
                    | append: product.id
                  -%}
                  <product-form-component
                    data-section-id="{{ section.id }}"
                    data-product-id="{{ product.id }}"
                    data-product-url="{{ product.url }}"
                    on:submit="/handleSubmit"
                    data-quantity-default="{% if v.quantity_rule.min %}{{ v.quantity_rule.min }}{% else %}1{% endif %}"
                  >
                    {%- form 'product', product, id: product_form_id, data-type: 'add-to-cart-form' -%}
                      <input type="hidden" name="id" ref="variantId" value="{{ v.id }}">
                      <div class="atc-wrap  relative">
                        {%
                          render 'add-to-cart-button',
                          can_add_to_cart: can_add_to_cart,
                          add_to_cart_text: add_to_cart_text,
                          product: product,
                          icon_only_on_mobile: true,
                          id: 'atc-' | append: product.id
                        %}
                      </div>
                    {%- endform -%}
                  </product-form-component>
                
                <p class="text-[#2A5072]! text-[10.5px]! not-italic font-normal leading-normal text-center">
                  {{ product.metafields.custom.product_features }}
                </p>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% else %}
      <p class="text-white/80 text-sm">Select a collection in section settings.</p>
    {% endif %}
  </div>
  <!-- Swiper init (mobile only) -->
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const root = document.querySelector('.swiper-{{ section.id }}');
      if (!root) return;
      const mq = window.matchMedia('(max-width: 1023px)');
      function setup() {
        if (mq.matches && !root._swiper) {
          root._swiper = new Swiper(root, {
            slidesPerView: 1.2,
            spaceBetween: 8,
            pagination: { el: root.querySelector('.swiper-pagination'), clickable: true },
            navigation: {
              nextEl: root.querySelector('.swiper-next-{{ section.id }}'),
              prevEl: root.querySelector('.swiper-prev-{{ section.id }}'),
            },
          });
        } else if (!mq.matches && root._swiper) {
          root._swiper.destroy(true, true);
          root._swiper = null;
        }
      }
      setup();
      mq.addEventListener('change', setup);
    });
  </script>
</section>

{% schema %}
{
  "name": "Collection Cards (Swiper)",
  "settings": [
    { "type": "collection", "id": "collection", "label": "Collection" },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4
    },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Good skin starts\nwith a good cleanse" },
    { "type": "textarea", "id": "copy", "label": "Right side copy" },
    { "type": "text", "id": "cta_label", "label": "CTA label" },
    { "type": "url", "id": "cta_link", "label": "CTA link" },
    { "type": "text", "id": "text-area", "label": "CTA label" },
    {
      "type": "range",
      "id": "margin_top_desktop",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Top (Desktop)",
      "default": 36
    },
    {
      "type": "range",
      "id": "margin_bottom_desktop",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Bottom (Desktop)",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Top (Desktop)",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom (Desktop)",
      "default": 36
    },
    {
      "type": "range",
      "id": "margin_top_mobile",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Margin Top (Mobile)",
      "default": 20
    },
    {
      "type": "range",
      "id": "margin_bottom_mobile",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Margin Bottom (Mobile)",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Padding Top (Mobile)",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom (Mobile)",
      "default": 20
    }
  ],
  "presets": [{ "name": "Collection Cards (Swiper)", "category": "Products" }]
}
{% endschema %}