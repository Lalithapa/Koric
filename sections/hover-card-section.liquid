{%- style -%}
  /* Keep only these dynamic spacings since Tailwind can't read Liquid values */
  .section-{{ section.id }}-margin {
    margin-top: {{ section.settings.margin_top_desktop }}px;
    margin-bottom: {{ section.settings.margin_bottom_desktop }}px;
  }
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top_desktop }}px;
    padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
  }
 .shopify-section:not(.header-section) :is(.section) {
    background: revert-layer !important;
}
  @media (max-width: 768px) {
    .section-{{ section.id }}-margin {
      margin-top: {{ section.settings.margin_top_mobile }}px;
      margin-bottom: {{ section.settings.margin_bottom_mobile }}px;
    }
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top_mobile }}px;
      padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
    }
    
  }
{%- endstyle -%}

<section id="exp-cards-{{ section.id }}" class="lg:block! hidden! w-full {{ section.settings.wrapper_bg }}! mx-auto section section--page-width section-{{ section.id }}-margin section-{{ section.id }}-padding rounded-t-[32px] bg-[#F7F5F2] ">
  <div class="  py-8 mx-auto section section--page-width">
       <!-- Header -->
    <span class="inline-block max-w-fit mb-[23px] rounded-[50px] bg-[#F9BDF9] shadow-[0_1px_1px_0_rgba(192,178,178,0.25)] px-4 py-[6px] text-[#2A5072] text-[12px]! font-medium tracking-wide uppercase">{{'Less foam. More care'}}</span>
    <div class="mb-14 flex flex-col items-start gap-4 md:mb-14 md:flex-row md:items-center md:justify-between md:gap-8">
      
    
      {% if section.settings.heading != blank %}
        <h2 class="text-[24px]! lg:text-[38px]! font-medium leading-[1.1] text-[#2A5072]! max-w-[400px]">
          {{ section.settings.heading }}
        </h2>
      {% endif %}
     
      {% if section.settings.subtext != blank %}
        <p class="max-w-[324px] text-[17px]! font-normal leading-none text-[#2A5072]">
          {{ section.settings.subtext }}
        </p>
      {% endif %}

      <div class="md:justify-self-end">
        {% if section.settings.cta_url != blank and section.settings.cta_label != blank %}
          <a
            href="{{ section.settings.cta_url }}"
            class="inline-flex items-center gap-2 text-[16px]! font-semibold uppercase tracking-wide text-[#2A5072]! underline  "
          >
            <span class="underline">{{ section.settings.cta_label }}</span>
            <span aria-hidden="true" class="text-[17px]">â†’</span>
          </a>
        {% endif %}
      </div>
     
    </div>

    <div class="flex gap-5" data-exp-row>
      {% for block in section.blocks %}
        {% assign b = block.settings %}
        <article
  class="exp-card group relative flex-[1_1_0%] h-[400px] rounded-xl overflow-hidden bg-gray-200 transition-[flex-basis,transform] duration-300 ease-out"
  {{ block.shopify_attributes }}
>
  {% if b.image != blank %}
    <img
      src="{{ b.image | image_url: width: 1600 }}"
      srcset="
        {{ b.image | image_url: width: 640 }} 640w,
        {{ b.image | image_url: width: 960 }} 960w,
        {{ b.image | image_url: width: 1280 }} 1280w,
        {{ b.image | image_url: width: 1600 }} 1600w
      "
      sizes="(min-width: 1024px) 25vw, 50vw"
      alt="{{ b.image_alt | escape }}"
      width="{{ b.image.width }}"
      height="{{ b.image.height }}"
      class="relative inset-0 h-full w-full object-cover"
      loading="lazy">
  {% else %}
    <div class="absolute inset-0 bg-gray-200"></div>
  {% endif %}

  {% if b.title != blank or b.text != blank or b.cta_label != blank %}
    <div class="pointer-events-none absolute bottom-0 p-5 md:p-6 w-full">
      {% if b.title != blank %}
        <h3 class="text-[#232323]! text-[16px]! font-bold! leading-normal uppercase">{{ b.title }}</h3>
      {% endif %}
      {% if b.text != blank %}
        <p class="mt-2 text-[#595959]! text-[12px]! font-normal! leading-[1.3] max-w-[160px] ">{{ b.text }}</p>
      {% endif %}
      {% if b.cta_label != blank %}
        <div class="pointer-events-auto mt-4">
          <a
            href="{{ b.cta_url | default: '#' }}"
            class="inline-flex justify-center rounded-full bg-[#ADD1F2]! w-full text-[#2A5072]! font-semibold! text-[14px]! py-3 px-20 whitespace-nowrap transition-all duration-300 
                   group-hover:bg-linear-to-r group-hover:from-[#AEC8F2] group-hover:to-[#F6E7E9]"
          >
            {{ b.cta_label }}
          </a>
        </div>
      {% endif %}
    </div>
  {% endif %}
</article>

      {% endfor %}
    </div>
  </div>
</section>

<script>
(() => {
  const root = document.getElementById('exp-cards-{{ section.id }}');
  if (!root) return;

  const row = root.querySelector('[data-exp-row]');
  const cards = row ? row.querySelectorAll('.exp-card') : [];
  if (!cards.length) return;

  const expandRatio = {{ section.settings.expand_percent | default: 40 }} / 100;
  const shrunkRatio = (1 - expandRatio) / Math.max(1, cards.length - 1);
  const expandedBasis = `${(expandRatio * 100).toFixed(8)}%`;
  const shrunkBasis = `${(shrunkRatio * 100).toFixed(8)}%`;

  function setExpanded(target) {
    cards.forEach(card => {
      if (card === target) {
        card.style.flexBasis = expandedBasis;
      } else {
        card.style.flexBasis = shrunkBasis;
      }
    });
  }

  function reset() {
    cards.forEach(card => {
      card.style.flexBasis = '';
    });
  }

  let hoverTimeout;
  cards.forEach(card => {
    card.addEventListener('mouseenter', () => {
      clearTimeout(hoverTimeout);
      hoverTimeout = setTimeout(() => setExpanded(card), 80);
    });
    card.addEventListener('mouseleave', () => clearTimeout(hoverTimeout));
    card.addEventListener('focusin', () => setExpanded(card));
    card.addEventListener('touchstart', () => setExpanded(card), { passive: true });
  });

  row.addEventListener('mouseleave', reset);
  document.addEventListener(
    'touchstart',
    e => {
      if (!root.contains(e.target)) reset();
    },
    { passive: true }
  );
})();
</script>


{% schema %}
{
  "name": "Expanding Cards Row",
 "class": "hover-card-section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Shop by skin need" },
    { "type": "text", "id": "subtext", "label": "Subtext", "default": "Each Koric bar is powered by micro-foaming technology and clinically backed actives." },
    { "type": "url", "id": "cta_url", "label": "Header link URL" },
    { "type": "text", "id": "cta_label", "label": "Header link label (desktop)", "default": "browse all" },
    { "type": "text", "id": "cta_label_mobile", "label": "Header link label (mobile)", "default": "BROWSE ALL" },
    { "type": "color", "id": "bg", "label": "Background color", "default": "#BFD7EA" },
    { "type": "range", "id": "margin_top_desktop", "min": 0, "max": 200, "step": 2, "unit": "px", "label": "Margin Top (Desktop)", "default": 36 },
    { "type": "range", "id": "margin_bottom_desktop", "min": 0, "max": 200, "step": 2, "unit": "px", "label": "Margin Bottom (Desktop)", "default": 36 },
    { "type": "range", "id": "padding_top_desktop", "min": 0, "max": 200, "step": 2, "unit": "px", "label": "Padding Top (Desktop)", "default": 36 },
    { "type": "range", "id": "padding_bottom_desktop", "min": 0, "max": 200, "step": 2, "unit": "px", "label": "Padding Bottom (Desktop)", "default": 36 },
    { "type": "range", "id": "margin_top_mobile", "min": 0, "max": 100, "step": 2, "unit": "px", "label": "Margin Top (Mobile)", "default": 20 },
    { "type": "range", "id": "margin_bottom_mobile", "min": 0, "max": 100, "step": 2, "unit": "px", "label": "Margin Bottom (Mobile)", "default": 20 },
    { "type": "range", "id": "padding_top_mobile", "min": 0, "max": 100, "step": 2, "unit": "px", "label": "Padding Top (Mobile)", "default": 20 },
    { "type": "range", "id": "padding_bottom_mobile", "min": 0, "max": 100, "step": 2, "unit": "px", "label": "Padding Bottom (Mobile)", "default": 20 }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Card",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "image_alt", "label": "Image alt" },
        { "type": "text", "id": "title", "label": "Title", "default": "ALPHA ARBUTIN" },
        { "type": "textarea", "id": "text", "label": "Description", "default": "Visibly fades tan and uneven tone while revealing a brighter, more even complexion" },
        { "type": "text", "id": "cta_label", "label": "Button label", "default": "VIEW PRODUCTS" },
        { "type": "url", "id": "cta_url", "label": "Button link" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Expanding Cards Row",
      "blocks": [
        { "type": "card" },
        { "type": "card" },
        { "type": "card" },
        { "type": "card" }
      ]
    }
  ]
}

{% endschema %}