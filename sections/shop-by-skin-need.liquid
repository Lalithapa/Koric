<!-- sections/shop-by-skin-need.liquid -->
{%- style -%}
  /* Keep only these dynamic spacings since Tailwind can't read Liquid values */
  .section-{{ section.id }}-margin {
    margin-top: {{ section.settings.margin_top_desktop }}px;
    margin-bottom: {{ section.settings.margin_bottom_desktop }}px;
  }
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top_desktop }}px;
    padding-bottom: {{ section.settings.padding_bottom_desktop }}px;
  }
  @media (max-width: 768px) {
    .section-{{ section.id }}-margin {
      margin-top: {{ section.settings.margin_top_mobile }}px;
      margin-bottom: {{ section.settings.margin_bottom_mobile }}px;
    }
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top_mobile }}px;
      padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
    }
  }
{%- endstyle -%}

<section
  id="skinneed-{{ section.id }}"
  class="w-full section-{{ section.id }}-margin section-{{ section.id }}-padding"
  style="background-color: {{ section.settings.bg | default: '#BFD7EA' }}"
>
  <div class=" mx-auto section section--page-width ">
    <div class="flex flex-col md:flex-row  md:justify-between gap-4! md:gap-8! lg:mb-[75px] mb-[60px]! lg:items-center items-start px-4 lg:px-0">
      {% if section.settings.heading != blank %}
        <h2 class="text-[26px]! lg:text-[38px]! font-medium leading-normal text-[#2A5072]!">
          {{ section.settings.heading }}
        </h2>
      {% endif %}

      {% if section.settings.subtext != blank %}
        <p class="max-w-[324px] lg:text-[17px]! text-[14px]! font-normal lg:leading-none leading-[1.1] text-[#2A5072]">
          {{ section.settings.subtext }}
        </p>
      {% endif %}

      <div class="md:justify-self-end">
        {% if section.settings.cta_url != blank and section.settings.cta_label != blank %}
          <a
            href="{{ section.settings.cta_url }}"
            class="inline-flex items-center gap-2 text-[16px]! font-semibold uppercase tracking-wide text-[#2A5072]! underline  "
          >
            <span class="underline">{{ section.settings.cta_label }}</span>
            <span aria-hidden="true" class="text-[17px]">â†’</span>
          </a>
        {% endif %}
      </div>
    </div>

    <!-- Desktop grid (>=1024px) -->
    <div class="hidden lg:grid! grid-cols-4 gap-4 lg:gap-4 mt-6 lg:mt-8">
      {% for block in section.blocks %}
        {% assign b = block.settings %}
        <a href="{{ b.link | default: '#' }}" class="group overflow-hidden rounded-[18px] bg-white/10 backdrop-blur-[0.5px] ring-1 ring-black/5">
          <div class="relative aspect-[3/4]">
            {% if b.image %}
              <img
                src="{{ b.image | image_url: width: 1200 }}"
                alt="{{ b.title | escape }}"
                width="100%"
                height="auto"
                class="absolute inset-0 h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.03]"
              >
            {% endif %}

            {% if b.title != blank %}
              <div class="absolute left-1/2 top-[5%] -translate-x-1/2 z-10 text-center text-[24px] font-bold leading-none text-white tracking-[.18em]">
                {{ b.title | upcase }}
              </div>
            {% endif %}

            <div class="absolute bottom-[15%] left-1/2 w-[80%] -translate-x-1/2">
              {% if b.title-bottom != blank %}
                <h3 class="mb-2 text-[20px] font-[900] leading-[19px] tracking-[-0.421px] text-[#232323]">
                  {{ b.title-bottom }}
                </h3>
              {% endif %}
              {% if b.text != blank %}
                <p class="text-[16px] leading-snug text-[#595959]">
                  {{ b.text }}
                </p>
              {% endif %}
            </div>

            <div class="absolute bottom-4 left-1/2 -translate-x-1/2">
              <span class="inline-flex items-center whitespace-nowrap rounded-full bg-[#ADD1F2] px-[80px] py-[15px] text-[14px] font-semibold text-[#23384a]">
                {{ b.cta_text | default: 'View Product' }}
              </span>
            </div>

            <div class="absolute inset-0 bg-gradient-to-t from-black/5 via-black/0 to-black/0"></div>
          </div>
        </a>
      {% endfor %}
    </div>

    <!-- Swiper for <1024px -->
    <div class="mt-4 lg:hidden">
      <div class="swiper skinneed-swiper">
        <div class="swiper-wrapper">
          {% for block in section.blocks %}
            {% assign b = block.settings %}
            <div class="swiper-slide">
              <a href="{{ b.link | default: '#' }}" class="block overflow-hidden rounded-[18px]">
                <div class="relative aspect-[3/4]">
                  {% if b.image %}
                    <img
                      src="{{ b.image | image_url: width: 1000 }}"
                      alt="{{ b.title | escape }}"
                      width="100%"
                      height="auto"
                      class="absolute inset-0 h-full w-full object-cover"
                    >
                  {% endif %}

                  {% if b.title != blank %}
                    <div class="absolute left-[30%] top-[10%] z-10 text-[24px] font-bold tracking-[.18em] text-white">
                      {{ b.title | upcase }}
                    </div>
                  {% endif %}

                  <div class="absolute bottom-[15%] left-1/2 w-[80%] -translate-x-1/2">
                    {% if b.title-bottom != blank %}
                      <h3 class="mb-2 text-[20px] font-[900] leading-[19px] tracking-[-0.421px] text-black">
                        {{ b.title-bottom }}
                      </h3>
                    {% endif %}
                    {% if b.text != blank %}
                      <p class="text-[16px] leading-snug text-black">
                        {{ b.text }}
                      </p>
                    {% endif %}
                  </div>

                  <div class="absolute bottom-3 left-1/2 -translate-x-1/2">
                    <span class="inline-flex items-center whitespace-nowrap rounded-full bg-[#ADD1F2] px-[80px] py-[15px] text-[14px] font-bold uppercase leading-normal text-[#2A5072]">
                      {{ b.cta_text | default: 'View Product' }}
                    </span>
                  </div>

                  <div class="absolute inset-0 bg-gradient-to-t from-black/10 via-black/0 to-black/0"></div>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
        <div class="swiper-pagination mt-3 hidden"></div>
      </div>
    </div>
  </div>
</section>

{%- comment -%} Swiper assets (load once) {%- endcomment -%}
{% unless content_for_header contains 'swiper-bundle.min.css' %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
{% endunless %}
{% unless content_for_header contains 'swiper-bundle.min.js' %}
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js" defer></script>
{% endunless %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const root = document.getElementById('skinneed-{{ section.id }}');
    if (!root) return;

    const swEl = root.querySelector('.skinneed-swiper');
    let swiper = null;

    function setSwiper() {
      // Run Swiper for widths < 1024px (Tailwind 'lg')
      const useSwiper = window.matchMedia('(max-width: 1023px)').matches;
      if (useSwiper && typeof Swiper !== 'undefined') {
        if (!swiper) {
          swiper = new Swiper(swEl, {
            slidesPerView: 1.15,
            spaceBetween: 12,
            centeredSlides: false,
            pagination: {
              el: root.querySelector('.swiper-pagination'),
              clickable: true
            }
          });
        }
      } else {
        if (swiper) {
          swiper.destroy(true, true);
          swiper = null;
        }
      }
    }

    setSwiper();
    window.addEventListener('resize', setSwiper);

    // Theme editor hooks
    document.addEventListener('shopify:section:load', setSwiper);
    document.addEventListener('shopify:section:reorder', setSwiper);
  });
</script>

{% schema %}
{
  "name": "Shop by skin need",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Shop by skin need" },
    { "type": "text", "id": "subtext", "label": "Subtext", "default": "Each Koric bar is powered by micro-foaming technology and clinically backed actives." },
    { "type": "url", "id": "cta_url", "label": "Header link URL" },
    { "type": "text", "id": "cta_label", "label": "Header link label (desktop)", "default": "browse all" },
    { "type": "text", "id": "cta_label_mobile", "label": "Header link label (mobile)", "default": "BROWSE ALL" },
    { "type": "color", "id": "bg", "label": "Background color", "default": "#BFD7EA" },
    { "type": "range", "id": "margin_top_desktop", "min": 0, "max": 200, "step": 2, "unit": "px", "label": "Margin Top (Desktop)", "default": 36 },
    { "type": "range", "id": "margin_bottom_desktop", "min": 30, "max": 200, "step": 2, "unit": "px", "label": "Margin Bottom (Desktop)", "default": 36 },
    { "type": "range", "id": "padding_top_desktop", "min": 0, "max": 200, "step": 2, "unit": "px", "label": "Padding Top (Desktop)", "default": 36 },
    { "type": "range", "id": "padding_bottom_desktop", "min": 0, "max": 200, "step": 2, "unit": "px", "label": "Padding Bottom (Desktop)", "default": 36 },
    { "type": "range", "id": "margin_top_mobile", "min": 0, "max": 100, "step": 2, "unit": "px", "label": "Margin Top (Mobile)", "default": 20 },
    { "type": "range", "id": "margin_bottom_mobile", "min": 20, "max": 100, "step": 2, "unit": "px", "label": "Margin Bottom (Mobile)", "default": 20 },
    { "type": "range", "id": "padding_top_mobile", "min": 0, "max": 100, "step": 2, "unit": "px", "label": "Padding Top (Mobile)", "default": 20 },
    { "type": "range", "id": "padding_bottom_mobile", "min": 0, "max": 100, "step": 2, "unit": "px", "label": "Padding Bottom (Mobile)", "default": 20 }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Skin need card",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "title", "label": "Overlay title", "default": "SUN TAN" },
        { "type": "text", "id": "cta_text", "label": "CTA text", "default": "View Product" },
        { "type": "text", "id": "title-bottom", "label": "Title bottom", "default": "ALPHA ARBUTIN" },
        { "type": "textarea", "id": "text", "label": "Description Bottom", "default": "Visibly fades tan and uneven tone while revealing a brighter, more even complexion" },
        { "type": "url", "id": "link", "label": "Card link URL" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shop by skin need",
      "category": "Image",
      "blocks": [{ "type": "card" }, { "type": "card" }, { "type": "card" }, { "type": "card" }]
    }
  ]
}
{% endschema %}
